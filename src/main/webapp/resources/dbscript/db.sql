DROP TABLE T_SEQ_MASTER;

CREATE TABLE T_SEQ_MASTER
(
	SEQ_NAME    VARCHAR(20) NOT NULL,
	NEXT_SEQ    NUMERIC(30) NULL,
   PRIMARY KEY (SEQ_NAME)
);


DROP TABLE T_BOARD_MASTER;

CREATE TABLE T_BOARD_MASTER
(
	BOARD_ID   CHAR(10) NOT NULL,
	BOARD_NM   VARCHAR(255) NOT NULL,
	DEL_YN     CHAR(1) DEFAULT 'N' NOT NULL,
	INST_TM    DATETIME NOT NULL,
	INST_ID    VARCHAR(20) NOT NULL,
	UPDT_TM    DATETIME NULL,
	UPDT_ID    VARCHAR(20) NULL,
	PRIMARY KEY (BOARD_ID)
);
/*
CREATE UNIQUE INDEX T_BOARD_MASTER_PK ON T_BOARD_MASTER
(
	BOARD_ID
);
*/

select SYSDATE();

/*
INSERT INTO T_BOARD_MASTER (BOARD_ID, BOARD_NM, INST_TM, INST_ID)
VALUES ('BOARD_0001', '일반게시판', sysdate(), 'SYSTEM');

INSERT INTO T_BOARD_MASTER (BOARD_ID, BOARD_NM, INST_TM, INST_ID)
VALUES ('BOARD_0002', '첨부파일게시판', sysdate(), 'SYSTEM');

INSERT INTO T_BOARD_MASTER (BOARD_ID, BOARD_NM, INST_TM, INST_ID)
VALUES ('BOARD_0003', '그리드게시판', sysdate(), 'SYSTEM');
*/

DROP TABLE T_BOARD;

CREATE TABLE T_BOARD
(
	CNTT_ID       NUMERIC(20) NOT NULL,
	BOARD_ID      CHAR(10) NOT NULL,
	CNTT_TITLE    VARCHAR(1000) NOT NULL,
	CNTT_POST     MEDIUMTEXT NULL,
	SORT_ORDR     NUMERIC(8) NULL,
	CNTT_HIT      NUMERIC(20) NULL,
	DEL_YN        CHAR(1) DEFAULT 'N' NOT NULL,
	AUTHOR_ID     VARCHAR(20) NULL,
	PASSWD        VARCHAR(200) NULL,
	ATCH_FILE_ID  CHAR(20) NULL,
	INST_TM       DATETIME NOT NULL,
	INST_ID       VARCHAR(20) NOT NULL,
	UPDT_TM       DATETIME NULL,
	UPDT_ID       VARCHAR(20) NULL,

	PRIMARY KEY (CNTT_ID,BOARD_ID)
);

DROP TABLE T_MEMBER;

CREATE TABLE T_MEMBER (
	`MBER_ID` VARCHAR(20) NOT NULL,
	`PASSWORD` VARCHAR(200) NOT NULL,
	`PASSWORD_HINT` VARCHAR(100) NULL DEFAULT NULL,
	`MBER_NM` VARCHAR(50) NOT NULL,
	`MBER_EMAIL` VARCHAR(50) NULL,
	`SUBSCR_DT` VARCHAR(8) NULL,
	`DEL_YN`  CHAR(1) DEFAULT 'N' NOT NULL,
	`INST_TM` DATETIME NOT NULL,
	`INST_ID` VARCHAR(20) NOT NULL,
	`UPDT_TM` DATETIME NULL,
	`UPDT_ID` VARCHAR(20) NULL,
	PRIMARY KEY (`MBER_ID`),
	UNIQUE INDEX `T_MEMBER_PK` (`MBER_ID`)
);


/* PASSWORD is 'tiger' */
/*
INSERT INTO T_MEMBER (
    MBER_ID
   ,`PASSWORD`
	,PASSWORD_HINT
	,MBER_NM
	,INST_TM
	,INST_ID
	,UPDT_TM
	,UPDT_ID
) VALUES (
   'kate'
   ,'qLxt8ONTTFS+7r9tV55D1ErTxm6rTsJN+/I4en+xSqA='
   ,'tiger'
   ,'Kate Elizabeth Winslet'
   ,NOW()
   ,'SYSTEM'
   ,NOW()
   ,'SYSTEM'
);
*/


DROP TABLE T_FILE;

CREATE TABLE `T_FILE` (
	`FILE_ID` CHAR(36) NOT NULL,
	`ATCH_FILE_ID` CHAR(20) NULL,
	`FILE_STRE_COURS` VARCHAR(2000) NOT NULL,
	`STRE_FILE_NM` VARCHAR(255) NOT NULL,
	`ORIGNL_FILE_NM` VARCHAR(255) NOT NULL,
	`FILE_EXTSN` VARCHAR(20) NOT NULL,
	`FILE_SIZE` DECIMAL(8,0) NULL DEFAULT 0,
	`INST_TM` DATETIME NOT NULL,
	`INST_ID` VARCHAR(20) NOT NULL,
	`UPDT_TM` DATETIME NULL,
	`UPDT_ID` VARCHAR(20) NULL,
	PRIMARY KEY (`FILE_ID`),
	UNIQUE INDEX `T_FILE_PK` (`FILE_ID`)
);

DROP TABLE T_ROLE;

CREATE TABLE T_ROLE
(
	ROLE_CODE     VARCHAR(30) NOT NULL,
	ROLE_NM       VARCHAR(60) NOT NULL,
	ROLE_DESC     VARCHAR(200) NULL,
	DEL_YN        CHAR(1) DEFAULT 'N' NOT NULL,
	INST_TM       DATETIME NOT NULL,
	UPDT_TM       DATETIME NOT NULL,
	PRIMARY KEY (ROLE_CODE)
);

INSERT INTO T_ROLE (ROLE_CODE, ROLE_NM, INST_TM, UPDT_TM) VALUES ('ROLE_ANONYMOUS','익명 사용자', NOW(), NOW());
INSERT INTO T_ROLE (ROLE_CODE, ROLE_NM, INST_TM, UPDT_TM) VALUES ('IS_AUTHENTICATED_ANONYMOUSLY' ,'스프링시큐리티 내부사용(롤부여 금지)', NOW(), NOW());
INSERT INTO T_ROLE (ROLE_CODE, ROLE_NM, INST_TM, UPDT_TM) VALUES ('IS_AUTHENTICATED_REMEMBERED'  ,'스프링시큐리티 내부사용(롤부여 금지)', NOW(), NOW());
INSERT INTO T_ROLE (ROLE_CODE, ROLE_NM, INST_TM, UPDT_TM) VALUES ('IS_AUTHENTICATED_FULLY'       ,'스프링시큐리티 내부사용(롤부여 금지)', NOW(), NOW());
INSERT INTO T_ROLE (ROLE_CODE, ROLE_NM, INST_TM, UPDT_TM) VALUES ('ROLE_USER', '일반 사용자', NOW(), NOW());
INSERT INTO T_ROLE (ROLE_CODE, ROLE_NM, INST_TM, UPDT_TM) VALUES ('ROLE_ADMIN', '관리자', NOW(), NOW());


/*
권한의 상하 관계
ROLE_A > ROLE_B ROLE_A 사용자는 ROLE_B를 자동으로 가진다.
*/
DROP TABLE T_ROLE_HIERARCHY;

CREATE TABLE T_ROLE_HIERARCHY
(
	PARNTS_ROLE  VARCHAR(30) NOT NULL,
	CHLDRN_ROLE  VARCHAR(30) NOT NULL,
	PRIMARY KEY (PARNTS_ROLE,CHLDRN_ROLE)
);

INSERT INTO T_ROLE_HIERARCHY VALUES ('ROLE_ANONYMOUS'               ,'IS_AUTHENTICATED_ANONYMOUSLY');
INSERT INTO T_ROLE_HIERARCHY VALUES ('IS_AUTHENTICATED_ANONYMOUSLY' ,'IS_AUTHENTICATED_REMEMBERED');
INSERT INTO T_ROLE_HIERARCHY VALUES ('IS_AUTHENTICATED_REMEMBERED'  ,'IS_AUTHENTICATED_FULLY');
INSERT INTO T_ROLE_HIERARCHY VALUES ('IS_AUTHENTICATED_FULLY'       ,'ROLE_USER');
INSERT INTO T_ROLE_HIERARCHY VALUES ('ROLE_USER'                    ,'ROLE_ADMIN');


/*
사용자-권한 매핑
여기에 정보가 없으면 인증되지 않는다.
*/
CREATE TABLE T_ROLE_USER_MAPPING
(
	MBER_ID          VARCHAR(20) NOT NULL,
	ROLE_CODE        VARCHAR(30) NOT NULL,
    INST_TM          DATETIME NOT NULL,
    UPDT_TM          DATETIME NOT NULL,
	PRIMARY KEY (MBER_ID, ROLE_CODE)
);

INSERT INTO T_ROLE_USER_MAPPING(MBER_ID, ROLE_CODE, INST_TM, UPDT_TM) VALUES ('scott', 'ROLE_USER', NOW(), NOW());
